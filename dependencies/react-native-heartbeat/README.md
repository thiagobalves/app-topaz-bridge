# react-native-heartbeat

A bridge for React Native and Heartbeat.

## Getting started

### Install on your project

`$ yarn add file:/path/to/react-native-heartbeat --save`

### Link

`$ yarn react-native link`

### iOS

1. Open up `ios/Podfile`
  - add lines below before `platform :ios...`
```
source 'https://git-codecommit.us-east-1.amazonaws.com/v1/repos/release-mobile-ios-specs' # Heartbeat
source 'https://cdn.cocoapods.org' # default
```
  - add lines below inside `target 'APPNAME' do` section
```
  use_frameworks!
  pod 'Firebase/MLVisionTextModel', '~> 6.34.0'
```
  - Comment lines related to flipper as is incompatible with `use_frameworks!`
2. Run `pod install` on ios directory after `yarn add` or `yarn install`
3. Open up `ios/AppName/Info.plist`
  - Add lines below inside <plist> section
```
	<key>NSCameraUsageDescription</key>
	<string>Usage of camera for document reading</string>
```
4. Open up `ios/AppName/AppName.cxworkspace` on XCode, select physical device and Run

### Android

1. Open up `android/build.gradle`
  - Set buildToolsVersion = 30.0.2 # or earlier
  - Set minSdkVersion = 23 # or earlier
  - Inside allprojects -> repositories section add:
```
  maven {
    url 's3://mobile-artifacts-repo/releases'
    credentials(AwsCredentials) {
      accessKey "${System.env.AWS_ACCESS_KEY}"
      secretKey "${System.env.AWS_SECRET_KEY}"
    }
  }

  maven {
    url 's3://mobile-artifacts-repo/releases-ofdcamera-face'
    credentials(AwsCredentials) {
      accessKey "${System.env.AWS_ACCESS_KEY}"
      secretKey "${System.env.AWS_SECRET_KEY}"
    }
  }
```

## Usage

### Import

```javascript
import RNHeartbeat from 'react-native-heartbeat';
```

### Methods

#### start

Heartbeat need a start call before being used, on a react native app this can be done at `componentDidMount` or `useEffect` function of main screen.

```
start(client_id, function successCallback(status), function failureCallback(status));
```

Where `client_id` is a string value determined by Heartbeat team.
`function successCallback(status)` is a function to be called on successful start, with status being a number value
`function failureCallback(status)` is a function to be called on failed start, with status being a number value
More info about status values can be found at Heartbeat documentation.

Example:
```
  componentDidMount() {
    RNHeartbeat.start('CLIENT_ID', status => {
      console.log(`Start success: ${status}`);
    }, err => {
      console.error(`Start failure: ${err}`);
    });
  }
```

```
  useEffect(() => {
    RNHeartbeat.start('CLIENT_ID', status => {
      console.log(`Start success: ${status}`);
    }, err => {
      console.error(`Start failure: ${err}`);
    });
  }, []);
```

#### sendEvent

Method to sendEvent like an Login Event.

```
sendEvent(parameters, function callback(error, message));
```

Example:
```
  function sendEvent() {
    const params = {
      USER_PARAM1: "123-4",
      USER_PARAM2: "5678-90",
      USER_PARAM3: "000.000.000-00",
      USER_PARAM4: "PF",
      SESSION_ID: "46F7764"
    }

    RNHeartbeat.sendEvent(params, (error, message) => {
      console.log(`SendEvent Error: ${error}, Message: ${message}`);
    });
  }
```

#### getSyncID

SyncID is a information generated by OFD Heartbeat that must be sent to the backend through the Transactional API in the "sync_id" field

```
getSyncID(function callback(response));
```

Example:
```
  function getSyncID() {
    RNHeartbeat.getSyncID((response) => {
      console.log(`GetSyncID: ${response}`);
    });
  }
```

#### sendDocFaceAuthorization

Method to open camera for document capturing and send image as base for the user.

```
sendDocFaceAuthorization(parameters, function callback(statusCode, image));
```

Example:
```
  function sendDocFace() {
    const params = {
      USER_PARAM1: "USER_PARAM1",
      USER_PARAM2: "USER_PARAM2",
      USER_PARAM3: "USER_PARAM3",
      USER_PARAM4: "USER_PARAM4",
      TRANSACTION_ID: 'session_id',
      SESSION_ID: 'transaction_id',
      TYPE: 'RG_BACK',
    };

    // image = Base64
    RNHeartbeat.sendDocFaceAuthorization(params, (statusCode, image) => {
      console.log(`SendDocFaceAuthorization StatusCode: ${statusCode} | Image: ${image}`);
    });
  }
```

#### startLivenessFaceAuthorization

Method to open camera for face liveness and check similarity.

```
startLivenessFaceAuthorization(parameters, function callback(statusCode, images));
```

Example:
```
  function startLivenessFace() {
    const params = {
      USER_PARAM1: "USER_PARAM1",
      USER_PARAM2: "USER_PARAM2",
      USER_PARAM3: "USER_PARAM3",
      USER_PARAM4: "USER_PARAM4",
      TRANSACTION_ID: 'session_id',
      SESSION_ID: 'transaction_id'
    };

    // images = Base64
    RNHeartbeat.startLivenessFaceAuthorization(params, (statusCode, images) => {
      console.log(`StartLivenessFaceAuthorization StatusCode: ${statusCode} | Images: ${images}`);
    });
  }
```

#### startCameraOCR

Method to open camera for document capturing, it will return a callback with info related to the capture.

```
startCameraOCR(params, function callback(statusCode, result, image));
```

Where params is a object with mandatory keys: 'TRANSACTION_ID', 'SESSION_ID' and 'TYPE', and options keys 'USER_PARAM1', 'USER_PARAM2', 'USER_PARAM3', 'USER_PARAM4'
And a callback function is expected, with 2 arguments
- status is a number status code
- result is a JSON string with fields and texts of the document.

More info can be found at Heartbeat documentation.

Example:
```
  RNHeartbeat.startOCR({
      'TRANSACTION_ID': randomUUID(),
      'SESSION_ID': sessionId(),
      'TYPE': 'DOC_TYPE'
    }, (statusCode, result) => {
    try {
      const doc = JSON.parse(result);
      console.log(`name: ${doc.nome}`);
    } catch (e) {
      console.error(`Error: ${e}`);
    }
  });
```

#### sendFilesOCR

Method to send documents for another app like Carteira Digital de Transito.

```
sendFilesOCR(parameters, files, callback(statusCode, result));
```

Example:
```
  function sendFilesOCR() {
    const params = {
      USER_PARAM1: "USER_PARAM1",
      USER_PARAM2: "USER_PARAM2",
      USER_PARAM3: "USER_PARAM3",
      USER_PARAM4: "USER_PARAM4",
      TRANSACTION_ID: 'session_id',
      SESSION_ID: 'transaction_id'
      TYPE: 'CNHD'
    };

    const files = [
      {
        FILE_NAME: 'CNH',
        MIME_TYPE: 'application/pdf',
        FILE_PATH: 'path/to/file.pdf'
      },
      {
        FILE_NAME: 'CNHP7S',
        MIME_TYPE: 'application/octet-stream',
        FILE_PATH: 'path/to/file.p7s'
      }
    ];

    // images = Base64
    RNHeartbeat.sendFilesOCR(params, files, (statusCode, result) => {
      console.log(`SendFilesOCR StatusCode: ${statusCode} | Result: ${result}`);
    });
  }
```
